{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 34,
   "id": "d0653dac-c77c-40b8-af56-170e66b32d23",
   "metadata": {},
   "outputs": [],
   "source": [
    "import warnings\n",
    "warnings.filterwarnings(\"ignore\")\n",
    "import sys\n",
    "import os\n",
    "import re\n",
    "import glob\n",
    "import pdfplumber\n",
    "import pandas as pd\n",
    "from datetime import datetime\n",
    "from contextlib import contextmanager"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "457329e5-444c-443d-b67d-0b8025fa734a",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Set your folder path containing the PDFs\n",
    "pdf_folder = \"C:/Users/xxxx/Food Expenditure\"  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "id": "e33fb977-00cb-4ec5-9f37-4b28d4355a3b",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Context manager to suppress standard error output\n",
    "@contextmanager\n",
    "def suppress_stderr():\n",
    "    with open(os.devnull, 'w') as devnull:\n",
    "        old_stderr = sys.stderr\n",
    "        sys.stderr = devnull\n",
    "        try:\n",
    "            yield\n",
    "        finally:\n",
    "            sys.stderr = old_stderr\n",
    "\n",
    "# Set your folder path containing the PDFs"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "id": "c1bcfefd-a3a1-47d1-a3b6-2d8c39451543",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Regex pattern to match REWE item lines\n",
    "item_price_pattern = re.compile(\n",
    "    r\"^([A-ZÄÖÜß0-9 .\\-/%]+?)\\s+([0-9]{1,2},[0-9]{2})\\s*[ABВ]?$\"\n",
    ")\n",
    "\n",
    "# Regex to extract the date from filename\n",
    "date_pattern = re.compile(r\"vom\\s(\\d{2}\\.\\d{2}\\.\\d{4})\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "id": "d7eae017-6866-4e69-b438-737decf138bb",
   "metadata": {},
   "outputs": [],
   "source": [
    "all_items = []\n",
    "\n",
    "# Loop through all PDF files in the folder\n",
    "for pdf_path in glob.glob(os.path.join(pdf_folder, \"*.pdf\")):\n",
    "    file_name = os.path.basename(pdf_path)\n",
    "    \n",
    "    # Try to extract the date from the filename\n",
    "    date_match = date_pattern.search(file_name)\n",
    "    if date_match:\n",
    "        shopping_date_str = date_match.group(1)  # e.g., \"01.06.2023\"\n",
    "        shopping_date = datetime.strptime(shopping_date_str, \"%d.%m.%Y\")\n",
    "    else:\n",
    "        shopping_date = None  # or set a default/fallback if needed\n",
    "\n",
    "    with suppress_stderr():\n",
    "        with pdfplumber.open(pdf_path) as pdf:\n",
    "            for page in pdf.pages:\n",
    "                # Reset cropbox to mediabox to avoid extraction issues\n",
    "                page.cropbox = page.mediabox\n",
    "                text = page.extract_text()\n",
    "                \n",
    "                if not text:\n",
    "                    continue\n",
    "\n",
    "                for line in text.split('\\n'):\n",
    "                    # Skip summary/payment lines\n",
    "                    if any(skip_word in line for skip_word in [\"SUMME\", \"Geg.\", \"EUR\", \"Bezahlung\", \"Betrag\", \"Steuer\", \"Gesamtbetrag\"]):\n",
    "                        continue\n",
    "\n",
    "                    match = item_price_pattern.match(line.strip())\n",
    "                    if match:\n",
    "                        item = match.group(1).strip()\n",
    "                        price = float(match.group(2).replace(\",\", \".\"))\n",
    "                        all_items.append({\n",
    "                            \"file\": file_name,\n",
    "                            \"date\": shopping_date,\n",
    "                            \"item\": item,\n",
    "                            \"total_paid\": price\n",
    "                        })"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "id": "5d878fa6-d1d3-452b-8fec-caacdb853157",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.DataFrame(all_items)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "id": "25a359cf-b2fb-4e0b-9dae-4f236346d4c1",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>file</th>\n",
       "      <th>date</th>\n",
       "      <th>item</th>\n",
       "      <th>total_paid</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>6.30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>BIO MEHRKORNBR.</td>\n",
       "      <td>2.79</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>RUSTIKAL KNAECKE</td>\n",
       "      <td>2.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>3.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>6.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>64</th>\n",
       "      <td>Dein REWE eBon vom 27.05.2023.pdf</td>\n",
       "      <td>2023-05-27</td>\n",
       "      <td>DUSCHE ICE KICK</td>\n",
       "      <td>1.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023 (1).pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>SPINAT 300G</td>\n",
       "      <td>2.50</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>66</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023.pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>5.37</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>67</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023.pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>68</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023.pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>69 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                                     file       date              item  \\\n",
       "0       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01     HA-BRUSTFILET   \n",
       "1       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01   BIO MEHRKORNBR.   \n",
       "2       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01  RUSTIKAL KNAECKE   \n",
       "3       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01       BABY SPINAT   \n",
       "4       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01            TOMATE   \n",
       "..                                    ...        ...               ...   \n",
       "64      Dein REWE eBon vom 27.05.2023.pdf 2023-05-27   DUSCHE ICE KICK   \n",
       "65  Dein REWE eBon vom 30.05.2023 (1).pdf 2023-05-30       SPINAT 300G   \n",
       "66      Dein REWE eBon vom 30.05.2023.pdf 2023-05-30     HA-BRUSTFILET   \n",
       "67      Dein REWE eBon vom 30.05.2023.pdf 2023-05-30   BIO FRISCHKAESE   \n",
       "68      Dein REWE eBon vom 30.05.2023.pdf 2023-05-30      GEMUESE FOND   \n",
       "\n",
       "    total_paid  \n",
       "0         6.30  \n",
       "1         2.79  \n",
       "2         2.39  \n",
       "3         3.98  \n",
       "4         6.98  \n",
       "..         ...  \n",
       "64        1.19  \n",
       "65        2.50  \n",
       "66        5.37  \n",
       "67        1.29  \n",
       "68        2.19  \n",
       "\n",
       "[69 rows x 4 columns]"
      ]
     },
     "execution_count": 42,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "7319c092-64ac-496c-832d-5f360b365bca",
   "metadata": {},
   "outputs": [],
   "source": [
    "nonfmcg_items = ['5 VERSCHL.-KLIPS', 'SENS.WHITE ZC', 'VOLLWASCHMITTEL', 'TO-GO SALATDOSE', 'SCHEUERSPIRALE', 'ALLZWECKTUECHER', 'OXI ACTIONPULVER', 'FRO.LIMO.SPUEL.', 'JA TOIPA 3LG', 'DUSCHE ICE KICK']\n",
    "\n",
    "df_fmcg = df.copy()\n",
    "df_fmcg = df[~df['item'].isin(nonfmcg_items)]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "294e366c-98e6-4196-932b-253eab268fdb",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>file</th>\n",
       "      <th>date</th>\n",
       "      <th>item</th>\n",
       "      <th>total_paid</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>6.30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>BIO MEHRKORNBR.</td>\n",
       "      <td>2.79</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>RUSTIKAL KNAECKE</td>\n",
       "      <td>2.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>3.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>6.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>Dein REWE eBon vom 01.06.2023.pdf</td>\n",
       "      <td>2023-06-01</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>Dein REWE eBon vom 02.06.2023.pdf</td>\n",
       "      <td>2023-06-02</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>6.47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Dein REWE eBon vom 02.06.2023.pdf</td>\n",
       "      <td>2023-06-02</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>3.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Dein REWE eBon vom 11.05.2023.pdf</td>\n",
       "      <td>2023-05-11</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>7.90</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>Dein REWE eBon vom 11.05.2023.pdf</td>\n",
       "      <td>2023-05-11</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>4.76</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>Dein REWE eBon vom 13.05.2023.pdf</td>\n",
       "      <td>2023-05-13</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>11.09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>Dein REWE eBon vom 13.05.2023.pdf</td>\n",
       "      <td>2023-05-13</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>Dein REWE eBon vom 13.05.2023.pdf</td>\n",
       "      <td>2023-05-13</td>\n",
       "      <td>BIO MEHRKORNBR.</td>\n",
       "      <td>2.79</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>Dein REWE eBon vom 13.05.2023.pdf</td>\n",
       "      <td>2023-05-13</td>\n",
       "      <td>RUSTIKAL KNAECKE</td>\n",
       "      <td>2.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>Dein REWE eBon vom 13.05.2023.pdf</td>\n",
       "      <td>2023-05-13</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>3.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>Dein REWE eBon vom 13.05.2023.pdf</td>\n",
       "      <td>2023-05-13</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>6.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>Dein REWE eBon vom 15.05.2023.pdf</td>\n",
       "      <td>2023-05-15</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>3.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>Dein REWE eBon vom 15.05.2023.pdf</td>\n",
       "      <td>2023-05-15</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>4.38</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>Dein REWE eBon vom 15.05.2023.pdf</td>\n",
       "      <td>2023-05-15</td>\n",
       "      <td>KOKOSMILCH LIGHT</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>Dein REWE eBon vom 16.05.2023.pdf</td>\n",
       "      <td>2023-05-16</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>9.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>Dein REWE eBon vom 16.05.2023.pdf</td>\n",
       "      <td>2023-05-16</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>Dein REWE eBon vom 16.05.2023.pdf</td>\n",
       "      <td>2023-05-16</td>\n",
       "      <td>BIO MEHRKORNBR.</td>\n",
       "      <td>2.79</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>Dein REWE eBon vom 16.05.2023.pdf</td>\n",
       "      <td>2023-05-16</td>\n",
       "      <td>RUSTIKAL KNAECKE</td>\n",
       "      <td>2.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>Dein REWE eBon vom 16.05.2023.pdf</td>\n",
       "      <td>2023-05-16</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>3.98</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>Dein REWE eBon vom 16.05.2023.pdf</td>\n",
       "      <td>2023-05-16</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>3.49</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>Dein REWE eBon vom 19.05.2023.pdf</td>\n",
       "      <td>2023-05-19</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>7.91</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>Dein REWE eBon vom 19.05.2023.pdf</td>\n",
       "      <td>2023-05-19</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>10.83</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>Dein REWE eBon vom 19.05.2023.pdf</td>\n",
       "      <td>2023-05-19</td>\n",
       "      <td>BIO MEHRKORNBR.</td>\n",
       "      <td>2.79</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>Dein REWE eBon vom 19.05.2023.pdf</td>\n",
       "      <td>2023-05-19</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>Dein REWE eBon vom 20.05.2023.pdf</td>\n",
       "      <td>2023-05-20</td>\n",
       "      <td>SPINAT 300G</td>\n",
       "      <td>2.50</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>Dein REWE eBon vom 20.05.2023.pdf</td>\n",
       "      <td>2023-05-20</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>3.49</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>Dein REWE eBon vom 22.05.2023.pdf</td>\n",
       "      <td>2023-05-22</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>9.28</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>Dein REWE eBon vom 22.05.2023.pdf</td>\n",
       "      <td>2023-05-22</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>8.93</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>Dein REWE eBon vom 22.05.2023.pdf</td>\n",
       "      <td>2023-05-22</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>Dein REWE eBon vom 22.05.2023.pdf</td>\n",
       "      <td>2023-05-22</td>\n",
       "      <td>RUSTIKAL KNAECKE</td>\n",
       "      <td>2.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>Dein REWE eBon vom 22.05.2023.pdf</td>\n",
       "      <td>2023-05-22</td>\n",
       "      <td>NUSSKERNMISCHUNG</td>\n",
       "      <td>9.99</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>Dein REWE eBon vom 22.05.2023.pdf</td>\n",
       "      <td>2023-05-22</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>Dein REWE eBon vom 23.05.2023.pdf</td>\n",
       "      <td>2023-05-23</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42</th>\n",
       "      <td>Dein REWE eBon vom 23.05.2023.pdf</td>\n",
       "      <td>2023-05-23</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>1.99</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>43</th>\n",
       "      <td>Dein REWE eBon vom 23.05.2023.pdf</td>\n",
       "      <td>2023-05-23</td>\n",
       "      <td>ZITRONE</td>\n",
       "      <td>0.89</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>Dein REWE eBon vom 23.05.2023.pdf</td>\n",
       "      <td>2023-05-23</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>3.49</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>48</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>8.06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>49</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>BIO MEHRKORNBR.</td>\n",
       "      <td>5.58</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>1.99</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>51</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>SPINAT 300G</td>\n",
       "      <td>2.50</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>52</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>TOMATE</td>\n",
       "      <td>3.49</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>53</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>54</th>\n",
       "      <td>Dein REWE eBon vom 25.05.2023.pdf</td>\n",
       "      <td>2023-05-25</td>\n",
       "      <td>KOKOSMILCH LIGHT</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>55</th>\n",
       "      <td>Dein REWE eBon vom 26.05.2023.pdf</td>\n",
       "      <td>2023-05-26</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>8.14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>56</th>\n",
       "      <td>Dein REWE eBon vom 26.05.2023.pdf</td>\n",
       "      <td>2023-05-26</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>5.51</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>57</th>\n",
       "      <td>Dein REWE eBon vom 26.05.2023.pdf</td>\n",
       "      <td>2023-05-26</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>5.56</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>58</th>\n",
       "      <td>Dein REWE eBon vom 27.05.2023.pdf</td>\n",
       "      <td>2023-05-27</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>59</th>\n",
       "      <td>Dein REWE eBon vom 27.05.2023.pdf</td>\n",
       "      <td>2023-05-27</td>\n",
       "      <td>BABY SPINAT</td>\n",
       "      <td>1.99</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>60</th>\n",
       "      <td>Dein REWE eBon vom 27.05.2023.pdf</td>\n",
       "      <td>2023-05-27</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>61</th>\n",
       "      <td>Dein REWE eBon vom 27.05.2023.pdf</td>\n",
       "      <td>2023-05-27</td>\n",
       "      <td>KOKOSMILCH LIGHT</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>65</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023 (1).pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>SPINAT 300G</td>\n",
       "      <td>2.50</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>66</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023.pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>HA-BRUSTFILET</td>\n",
       "      <td>5.37</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>67</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023.pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>BIO FRISCHKAESE</td>\n",
       "      <td>1.29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>68</th>\n",
       "      <td>Dein REWE eBon vom 30.05.2023.pdf</td>\n",
       "      <td>2023-05-30</td>\n",
       "      <td>GEMUESE FOND</td>\n",
       "      <td>2.19</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                     file       date              item  \\\n",
       "0       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01     HA-BRUSTFILET   \n",
       "1       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01   BIO MEHRKORNBR.   \n",
       "2       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01  RUSTIKAL KNAECKE   \n",
       "3       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01       BABY SPINAT   \n",
       "4       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01            TOMATE   \n",
       "5       Dein REWE eBon vom 01.06.2023.pdf 2023-06-01      GEMUESE FOND   \n",
       "6       Dein REWE eBon vom 02.06.2023.pdf 2023-06-02     HA-BRUSTFILET   \n",
       "7       Dein REWE eBon vom 02.06.2023.pdf 2023-06-02       BABY SPINAT   \n",
       "8       Dein REWE eBon vom 11.05.2023.pdf 2023-05-11     HA-BRUSTFILET   \n",
       "9       Dein REWE eBon vom 11.05.2023.pdf 2023-05-11     HA-BRUSTFILET   \n",
       "11      Dein REWE eBon vom 13.05.2023.pdf 2023-05-13     HA-BRUSTFILET   \n",
       "12      Dein REWE eBon vom 13.05.2023.pdf 2023-05-13   BIO FRISCHKAESE   \n",
       "13      Dein REWE eBon vom 13.05.2023.pdf 2023-05-13   BIO MEHRKORNBR.   \n",
       "14      Dein REWE eBon vom 13.05.2023.pdf 2023-05-13  RUSTIKAL KNAECKE   \n",
       "15      Dein REWE eBon vom 13.05.2023.pdf 2023-05-13       BABY SPINAT   \n",
       "16      Dein REWE eBon vom 13.05.2023.pdf 2023-05-13            TOMATE   \n",
       "17      Dein REWE eBon vom 15.05.2023.pdf 2023-05-15       BABY SPINAT   \n",
       "18      Dein REWE eBon vom 15.05.2023.pdf 2023-05-15      GEMUESE FOND   \n",
       "19      Dein REWE eBon vom 15.05.2023.pdf 2023-05-15  KOKOSMILCH LIGHT   \n",
       "22      Dein REWE eBon vom 16.05.2023.pdf 2023-05-16     HA-BRUSTFILET   \n",
       "23      Dein REWE eBon vom 16.05.2023.pdf 2023-05-16   BIO FRISCHKAESE   \n",
       "24      Dein REWE eBon vom 16.05.2023.pdf 2023-05-16   BIO MEHRKORNBR.   \n",
       "25      Dein REWE eBon vom 16.05.2023.pdf 2023-05-16  RUSTIKAL KNAECKE   \n",
       "26      Dein REWE eBon vom 16.05.2023.pdf 2023-05-16       BABY SPINAT   \n",
       "27      Dein REWE eBon vom 16.05.2023.pdf 2023-05-16            TOMATE   \n",
       "28      Dein REWE eBon vom 19.05.2023.pdf 2023-05-19     HA-BRUSTFILET   \n",
       "29      Dein REWE eBon vom 19.05.2023.pdf 2023-05-19     HA-BRUSTFILET   \n",
       "30      Dein REWE eBon vom 19.05.2023.pdf 2023-05-19   BIO MEHRKORNBR.   \n",
       "31      Dein REWE eBon vom 19.05.2023.pdf 2023-05-19      GEMUESE FOND   \n",
       "32      Dein REWE eBon vom 20.05.2023.pdf 2023-05-20       SPINAT 300G   \n",
       "33      Dein REWE eBon vom 20.05.2023.pdf 2023-05-20            TOMATE   \n",
       "35      Dein REWE eBon vom 22.05.2023.pdf 2023-05-22     HA-BRUSTFILET   \n",
       "36      Dein REWE eBon vom 22.05.2023.pdf 2023-05-22     HA-BRUSTFILET   \n",
       "37      Dein REWE eBon vom 22.05.2023.pdf 2023-05-22   BIO FRISCHKAESE   \n",
       "38      Dein REWE eBon vom 22.05.2023.pdf 2023-05-22  RUSTIKAL KNAECKE   \n",
       "39      Dein REWE eBon vom 22.05.2023.pdf 2023-05-22  NUSSKERNMISCHUNG   \n",
       "40      Dein REWE eBon vom 22.05.2023.pdf 2023-05-22      GEMUESE FOND   \n",
       "41      Dein REWE eBon vom 23.05.2023.pdf 2023-05-23   BIO FRISCHKAESE   \n",
       "42      Dein REWE eBon vom 23.05.2023.pdf 2023-05-23       BABY SPINAT   \n",
       "43      Dein REWE eBon vom 23.05.2023.pdf 2023-05-23           ZITRONE   \n",
       "44      Dein REWE eBon vom 23.05.2023.pdf 2023-05-23            TOMATE   \n",
       "48      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25     HA-BRUSTFILET   \n",
       "49      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25   BIO MEHRKORNBR.   \n",
       "50      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25       BABY SPINAT   \n",
       "51      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25       SPINAT 300G   \n",
       "52      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25            TOMATE   \n",
       "53      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25      GEMUESE FOND   \n",
       "54      Dein REWE eBon vom 25.05.2023.pdf 2023-05-25  KOKOSMILCH LIGHT   \n",
       "55      Dein REWE eBon vom 26.05.2023.pdf 2023-05-26     HA-BRUSTFILET   \n",
       "56      Dein REWE eBon vom 26.05.2023.pdf 2023-05-26     HA-BRUSTFILET   \n",
       "57      Dein REWE eBon vom 26.05.2023.pdf 2023-05-26     HA-BRUSTFILET   \n",
       "58      Dein REWE eBon vom 27.05.2023.pdf 2023-05-27   BIO FRISCHKAESE   \n",
       "59      Dein REWE eBon vom 27.05.2023.pdf 2023-05-27       BABY SPINAT   \n",
       "60      Dein REWE eBon vom 27.05.2023.pdf 2023-05-27      GEMUESE FOND   \n",
       "61      Dein REWE eBon vom 27.05.2023.pdf 2023-05-27  KOKOSMILCH LIGHT   \n",
       "65  Dein REWE eBon vom 30.05.2023 (1).pdf 2023-05-30       SPINAT 300G   \n",
       "66      Dein REWE eBon vom 30.05.2023.pdf 2023-05-30     HA-BRUSTFILET   \n",
       "67      Dein REWE eBon vom 30.05.2023.pdf 2023-05-30   BIO FRISCHKAESE   \n",
       "68      Dein REWE eBon vom 30.05.2023.pdf 2023-05-30      GEMUESE FOND   \n",
       "\n",
       "    total_paid  \n",
       "0         6.30  \n",
       "1         2.79  \n",
       "2         2.39  \n",
       "3         3.98  \n",
       "4         6.98  \n",
       "5         2.19  \n",
       "6         6.47  \n",
       "7         3.98  \n",
       "8         7.90  \n",
       "9         4.76  \n",
       "11       11.09  \n",
       "12        1.29  \n",
       "13        2.79  \n",
       "14        2.39  \n",
       "15        3.98  \n",
       "16        6.98  \n",
       "17        3.98  \n",
       "18        4.38  \n",
       "19        2.19  \n",
       "22        9.39  \n",
       "23        1.29  \n",
       "24        2.79  \n",
       "25        2.39  \n",
       "26        3.98  \n",
       "27        3.49  \n",
       "28        7.91  \n",
       "29       10.83  \n",
       "30        2.79  \n",
       "31        2.19  \n",
       "32        2.50  \n",
       "33        3.49  \n",
       "35        9.28  \n",
       "36        8.93  \n",
       "37        1.29  \n",
       "38        2.39  \n",
       "39        9.99  \n",
       "40        2.19  \n",
       "41        1.29  \n",
       "42        1.99  \n",
       "43        0.89  \n",
       "44        3.49  \n",
       "48        8.06  \n",
       "49        5.58  \n",
       "50        1.99  \n",
       "51        2.50  \n",
       "52        3.49  \n",
       "53        2.19  \n",
       "54        2.19  \n",
       "55        8.14  \n",
       "56        5.51  \n",
       "57        5.56  \n",
       "58        1.29  \n",
       "59        1.99  \n",
       "60        2.19  \n",
       "61        2.19  \n",
       "65        2.50  \n",
       "66        5.37  \n",
       "67        1.29  \n",
       "68        2.19  "
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_fmcg"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "2f4440de-db5a-4c94-9670-356d19ab840d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "item\n",
       "HA-BRUSTFILET       15\n",
       "BABY SPINAT          8\n",
       "GEMUESE FOND         7\n",
       "TOMATE               6\n",
       "BIO FRISCHKAESE      6\n",
       "BIO MEHRKORNBR.      5\n",
       "RUSTIKAL KNAECKE     4\n",
       "KOKOSMILCH LIGHT     3\n",
       "SPINAT 300G          3\n",
       "NUSSKERNMISCHUNG     1\n",
       "ZITRONE              1\n",
       "Name: count, dtype: int64"
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_fmcg['item'].value_counts()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "id": "b946a83a-5113-49a2-aa7c-b3382c495bb5",
   "metadata": {},
   "outputs": [],
   "source": [
    "label_map = {\n",
    "    \"HA-BRUSTFILET\": \"Poultry\",\n",
    "    \"BABY SPINAT\": \"Fruits and Vegetables\",\n",
    "    \"GEMUESE FOND\": \"Fruits and Vegetables\",\n",
    "    \"TOMATE\": \"Fruits and Vegetables\",\n",
    "    \"SPINAT 300G\": \"Fruits and Vegetables\",\n",
    "    \"ZITRONE\": \"Fruits and Vegetables\",\n",
    "    \"BIO FRISCHKAESE\": \"Bready, Dairy, Nuts and Rice\",\n",
    "    \"BIO MEHRKORNBR.\": \"Bready, Dairy, Nuts and Rice\",\n",
    "    \"RUSTIKAL KNAECKE\": \"Bready, Dairy, Nuts and Rice\",\n",
    "    \"KOKOSMILCH LIGHT\": \"Bready, Dairy, Nuts and Rice\",\n",
    "    \"NUSSKERNMISCHUNG\": \"Bready, Dairy, Nuts and Rice\"\n",
    "}\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "id": "9239d814-ffb4-4197-90a1-5c585c3c8408",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_fmcg['fmcg_label'] = df_fmcg['item'].map(label_map).fillna(\"Other\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "id": "d61d7093-1ced-4b27-92eb-dfdb085fadcf",
   "metadata": {},
   "outputs": [],
   "source": [
    "df_fmcg.to_csv('C:/Users/rugge/Downloads/df_fmcg.csv', index=False)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "id": "fa94d280-1715-4f58-b6da-ec82b075cb5c",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>fmcg_label</th>\n",
       "      <th>total_paid</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Bready, Dairy, Nuts and Rice</td>\n",
       "      <td>50.6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Fruits and Vegetables</td>\n",
       "      <td>79.7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Poultry</td>\n",
       "      <td>115.5</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                     fmcg_label  total_paid\n",
       "0  Bready, Dairy, Nuts and Rice        50.6\n",
       "1         Fruits and Vegetables        79.7\n",
       "2                       Poultry       115.5"
      ]
     },
     "execution_count": 49,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_groupspend = df_fmcg.groupby('fmcg_label')['total_paid'].sum().reset_index()\n",
    "\n",
    "df_groupspend"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "id": "d4db6e28-5d72-4430-aae1-42d5d3b9729e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>fmcg_label</th>\n",
       "      <th>total_paid</th>\n",
       "      <th>share</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Bready, Dairy, Nuts and Rice</td>\n",
       "      <td>51.0</td>\n",
       "      <td>21.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Fruits and Vegetables</td>\n",
       "      <td>80.0</td>\n",
       "      <td>32.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Poultry</td>\n",
       "      <td>116.0</td>\n",
       "      <td>47.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                     fmcg_label  total_paid  share\n",
       "0  Bready, Dairy, Nuts and Rice        51.0   21.0\n",
       "1         Fruits and Vegetables        80.0   32.0\n",
       "2                       Poultry       116.0   47.0"
      ]
     },
     "execution_count": 50,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Calculate total spend\n",
    "total_spend = df_fmcg['total_paid'].sum()\n",
    "\n",
    "# Calculate share and share_percent for each category\n",
    "df_groupspend['share'] = 100*df_groupspend['total_paid']/ total_spend\n",
    "\n",
    "df_groupspend[['fmcg_label','total_paid','share']].round(0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "d7c24dfa-5617-414a-9ff1-d8a78da75946",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "Weekly spend: €78\n"
     ]
    }
   ],
   "source": [
    "# Calculate weekly spend (pro-rata for 7 days)\n",
    "weekly_spend = (total_spend / 22 * 7)\n",
    "\n",
    "print(f\"\\nWeekly spend: €{weekly_spend:.0f}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b56fc9f7-df52-4cc2-ac35-7f5a8fccbe50",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1297286f-8a99-4a14-95c5-b4f4ad69933f",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:base] *",
   "language": "python",
   "name": "conda-base-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
